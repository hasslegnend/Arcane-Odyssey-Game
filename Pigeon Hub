-- SERVICES
local Players = game:GetService("Players")
local UIS = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local plr = Players.LocalPlayer

-- GUI ROOT
local Gui = Instance.new("ScreenGui", plr.PlayerGui)
Gui.Name = "PigeonHub"

local Main = Instance.new("Frame", Gui)
Main.Size = UDim2.new(0, 600, 0, 520)
Main.Position = UDim2.new(0.5,0,0.5,0)
Main.AnchorPoint = Vector2.new(0.5,0.5)
Main.BackgroundColor3 = Color3.fromRGB(20,20,20)
Main.Active = true
Main.Draggable = true
Instance.new("UICorner", Main).CornerRadius = UDim.new(0,12)

-- TOP BAR
local Top = Instance.new("Frame", Main)
Top.Size = UDim2.new(1,0,0,40)
Top.BackgroundColor3 = Color3.fromRGB(25,25,25)
Instance.new("UICorner", Top).CornerRadius = UDim.new(0,12)

local Title = Instance.new("TextLabel", Top)
Title.Position = UDim2.new(0,50,0,0)
Title.Size = UDim2.new(1,-50,1,0)
Title.BackgroundTransparency = 1
Title.Text = "PigeonHub"
Title.Font = Enum.Font.GothamBold
Title.TextSize = 16
Title.TextXAlignment = Enum.TextXAlignment.Left
Title.TextColor3 = Color3.new(1,1,1)

-- ICON PLACEHOLDER
local Icon = Instance.new("Frame", Top)
Icon.Position = UDim2.new(0,12,0.5,-10)
Icon.Size = UDim2.new(0,20,0,20)
Icon.BackgroundColor3 = Color3.fromRGB(40,40,40)
Instance.new("UICorner", Icon).CornerRadius = UDim.new(0,4)

-- SIDEBAR
local Sidebar = Instance.new("Frame", Main)
Sidebar.Position = UDim2.new(0,0,0,40)
Sidebar.Size = UDim2.new(0,140,1,-40)
Sidebar.BackgroundColor3 = Color3.fromRGB(23,23,23)
Instance.new("UICorner", Sidebar).CornerRadius = UDim.new(0,12)

-- CONTENT
local Content = Instance.new("Frame", Main)
Content.Position = UDim2.new(0,140,0,40)
Content.Size = UDim2.new(1,-140,1,-40)
Content.BackgroundTransparency = 1

-- SECTION FACTORY
local function newSection()
	local s = Instance.new("ScrollingFrame", Content)
	s.Size = UDim2.new(1,-20,1,-20)
	s.Position = UDim2.new(0,10,0,10)
	s.ScrollBarThickness = 6
	s.AutomaticCanvasSize = Enum.AutomaticSize.Y
	s.BackgroundColor3 = Color3.fromRGB(16,16,16)
	s.Visible = false
	Instance.new("UICorner", s).CornerRadius = UDim.new(0,8)
	Instance.new("UIListLayout", s).Padding = UDim.new(0,8)
	return s
end

local MainSec = newSection()
local OpSec   = newSection()
local MiscSec = newSection()
MainSec.Visible = true

-- SIDEBAR BUTTONS
local function sideBtn(text, y, cb)
	local b = Instance.new("TextButton", Sidebar)
	b.Size = UDim2.new(1,-10,0,36)
	b.Position = UDim2.new(0,5,0,y)
	b.Text = text
	b.Font = Enum.Font.GothamBold
	b.TextSize = 14
	b.TextColor3 = Color3.new(1,1,1)
	b.BackgroundColor3 = Color3.fromRGB(35,35,35)
	Instance.new("UICorner", b).CornerRadius = UDim.new(0,8)
	b.MouseButton1Click:Connect(cb)
end

sideBtn("Main", 10, function()
	MainSec.Visible, OpSec.Visible, MiscSec.Visible = true,false,false
end)
sideBtn("OP", 56, function()
	MainSec.Visible, OpSec.Visible, MiscSec.Visible = false,true,false
end)
sideBtn("Misc", 102, function()
	MainSec.Visible, OpSec.Visible, MiscSec.Visible = false,false,true
end)

-- === TOGGLE + KEYBIND SYSTEM ===
local keybinds = {}

UIS.InputBegan:Connect(function(i,gp)
	if gp or not i.KeyCode then return end
	for _,v in pairs(keybinds) do
		if v.Key == i.KeyCode then
			v.Toggle()
		end
	end
end)

local function toggleRow(parent, text, callback)
	local row = Instance.new("Frame", parent)
	row.Size = UDim2.new(1,0,0,30)
	row.BackgroundTransparency = 1

	local label = Instance.new("TextLabel", row)
	label.Size = UDim2.new(0.45,0,1,0)
	label.BackgroundTransparency = 1
	label.Text = text
	label.TextXAlignment = Enum.TextXAlignment.Left
	label.Font = Enum.Font.GothamBold
	label.TextSize = 14
	label.TextColor3 = Color3.new(1,1,1)

	local keyBtn = Instance.new("TextButton", row)
	keyBtn.Size = UDim2.new(0,50,0,22)
	keyBtn.Position = UDim2.new(0.55,0,0.5,-11)
	keyBtn.Text = "None"
	keyBtn.Font = Enum.Font.Gotham
	keyBtn.TextSize = 12
	keyBtn.BackgroundColor3 = Color3.fromRGB(45,45,45)
	keyBtn.TextColor3 = Color3.new(1,1,1)
	Instance.new("UICorner", keyBtn).CornerRadius = UDim.new(0,6)

	local toggleBg = Instance.new("Frame", row)
	toggleBg.Size = UDim2.new(0,42,0,22)
	toggleBg.Position = UDim2.new(1,-50,0.5,-11)
	toggleBg.BackgroundColor3 = Color3.fromRGB(60,60,60)
	Instance.new("UICorner", toggleBg).CornerRadius = UDim.new(1,0)

	local knob = Instance.new("Frame", toggleBg)
	knob.Size = UDim2.new(0,18,0,18)
	knob.Position = UDim2.new(0,2,0.5,-9)
	knob.BackgroundColor3 = Color3.new(1,1,1)
	Instance.new("UICorner", knob).CornerRadius = UDim.new(1,0)

	local state = false
	local function set(v)
		state = v
		toggleBg.BackgroundColor3 = v and Color3.fromRGB(0,140,255) or Color3.fromRGB(60,60,60)
		knob.Position = v and UDim2.new(1,-20,0.5,-9) or UDim2.new(0,2,0.5,-9)
		callback(v)
	end

	toggleBg.InputBegan:Connect(function()
		set(not state)
	end)

	keyBtn.MouseButton1Click:Connect(function()
		keyBtn.Text = "..."
		local conn
		conn = UIS.InputBegan:Connect(function(i)
			if i.KeyCode then
				keyBtn.Text = i.KeyCode.Name
				keybinds[text] = {Key=i.KeyCode, Toggle=function() set(not state) end}
				conn:Disconnect()
			end
		end)
	end)
end

-- === FEATURES ===

-- CLICK TP
toggleRow(MainSec,"Click TP",function(v)
	RunService.RenderStepped:Connect(function()
		if v and UIS:IsKeyDown(Enum.KeyCode.LeftControl)
		and UIS:IsMouseButtonPressed(Enum.UserInputType.MouseButton1)
		and plr.Character then
			local hrp = plr.Character:FindFirstChild("HumanoidRootPart")
			if hrp then
				local ray = workspace.CurrentCamera:ScreenPointToRay(
					UIS:GetMouseLocation().X, UIS:GetMouseLocation().Y)
				hrp.CFrame = CFrame.new(ray.Origin + ray.Direction * 100)
			end
		end
	end)
end)

-- INFINITE JUMP
toggleRow(MainSec,"Infinite Jump",function(v)
	UIS.JumpRequest:Connect(function()
		if v and plr.Character then
			plr.Character.Humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
		end
	end)
end)

-- NOCLIP
toggleRow(MainSec,"Noclip",function(v)
	RunService.Stepped:Connect(function()
		if v and plr.Character then
			for _,p in pairs(plr.Character:GetChildren()) do
				if p:IsA("BasePart") then p.CanCollide = false end
			end
		end
	end)
end)

-- AUTO BIRDKILL
toggleRow(OpSec,"Auto BirdKill",function(v)
	if not v then return end
	task.spawn(function()
		local r = game.ReplicatedStorage.RS.Remotes.Misc.BirdKill
		while v do r:FireServer("Eagle") task.wait(1) end
	end)
end)

-- AUTO WASH
toggleRow(OpSec,"Auto Wash",function(v)
	if not v then return end
	task.spawn(function()
		local r = game.ReplicatedStorage.RS.Remotes.Boats.Wash
		while v do r:FireServer() task.wait(2) end
	end)
end)

-- CHEST ESP
toggleRow(MiscSec,"Chest ESP",function(v)
	-- simplified ESP toggle
end)
