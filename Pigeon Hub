
local Players = game:GetService("Players")
local UIS = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local plr = Players.LocalPlayer

-- CONSTANTS
local ROW_HEIGHT = 30
local FONT = Enum.Font.GothamBold

-- GUI
local Gui = Instance.new("ScreenGui", plr.PlayerGui)
Gui.Name = "PigeonGui"

local Main = Instance.new("Frame", Gui)
Main.Size = UDim2.new(0, 520, 0, 520) -- square
Main.Position = UDim2.new(0.5,0,0.5,0)
Main.AnchorPoint = Vector2.new(0.5,0.5)
Main.BackgroundColor3 = Color3.fromRGB(18,18,18)
Main.Active = true
Main.Draggable = true

-- TOP BAR
local Top = Instance.new("Frame", Main)
Top.Size = UDim2.new(1,0,0,40)
Top.BackgroundColor3 = Color3.fromRGB(25,25,25)

local Icon = Instance.new("ImageLabel", Top)
Icon.Size = UDim2.new(0,24,0,24)
Icon.Position = UDim2.new(0,8,0.5,-12)
Icon.BackgroundTransparency = 1
Icon.Image = "" -- empty on purpose

local Title = Instance.new("TextLabel", Top)
Title.Position = UDim2.new(0,40,0,0)
Title.Size = UDim2.new(1,-40,1,0)
Title.BackgroundTransparency = 1
Title.Text = "PigeonHub"
Title.Font = FONT
Title.TextSize = 16
Title.TextXAlignment = Enum.TextXAlignment.Left
Title.TextColor3 = Color3.new(1,1,1)

-- SIDEBAR
local Sidebar = Instance.new("Frame", Main)
Sidebar.Position = UDim2.new(0,0,0,40)
Sidebar.Size = UDim2.new(0,120,1,-40)
Sidebar.BackgroundColor3 = Color3.fromRGB(22,22,22)

local function sidebarButton(text, y, callback)
	local b = Instance.new("TextButton", Sidebar)
	b.Size = UDim2.new(1,0,0,36)
	b.Position = UDim2.new(0,0,0,y)
	b.Text = text
	b.Font = FONT
	b.TextSize = 14
	b.TextColor3 = Color3.new(1,1,1)
	b.BackgroundColor3 = Color3.fromRGB(35,35,35)
	b.MouseButton1Click:Connect(callback)
	return b
end

-- CONTENT HOLDER
local Content = Instance.new("Frame", Main)
Content.Position = UDim2.new(0,120,0,40)
Content.Size = UDim2.new(1,-120,1,-40)
Content.BackgroundTransparency = 1

local function createSection()
	local s = Instance.new("ScrollingFrame", Content)
	s.Size = UDim2.new(1,-20,1,-20)
	s.Position = UDim2.new(0,10,0,10)
	s.ScrollBarThickness = 6
	s.AutomaticCanvasSize = Enum.AutomaticSize.Y
	s.Visible = false
	s.BackgroundColor3 = Color3.fromRGB(15,15,15)

	local l = Instance.new("UIListLayout", s)
	l.Padding = UDim.new(0,8)
	return s
end

local MainSection = createSection()
local OpSection   = createSection()
local MiscSection = createSection()

MainSection.Visible = true

sidebarButton("Main", 10, function()
	MainSection.Visible = true
	OpSection.Visible = false
	MiscSection.Visible = false
end)

sidebarButton("OP", 56, function()
	MainSection.Visible = false
	OpSection.Visible = true
	MiscSection.Visible = false
end)

sidebarButton("Misc", 102, function()
	MainSection.Visible = false
	OpSection.Visible = false
	MiscSection.Visible = true
end)

-- HELPERS
local function createRow(parent)
	local r = Instance.new("Frame", parent)
	r.Size = UDim2.new(1,0,0,ROW_HEIGHT)
	r.BackgroundTransparency = 1
	return r
end

local function label(row, text)
	local l = Instance.new("TextLabel", row)
	l.Size = UDim2.new(0.5,0,1,0)
	l.BackgroundTransparency = 1
	l.Text = text
	l.Font = FONT
	l.TextSize = 14
	l.TextXAlignment = Enum.TextXAlignment.Left
	l.TextColor3 = Color3.new(1,1,1)
end

local function input(row, x, placeholder)
	local t = Instance.new("TextBox", row)
	t.Size = UDim2.new(0,70,1,0)
	t.Position = UDim2.new(0,x,0,0)
	t.PlaceholderText = placeholder
	t.BackgroundColor3 = Color3.fromRGB(60,60,60)
	t.TextColor3 = Color3.new(1,1,1)
	t.Font = Enum.Font.Gotham
	t.TextSize = 14
	return t
end

local function button(row, x, text, color, cb)
	local b = Instance.new("TextButton", row)
	b.Size = UDim2.new(0,70,1,0)
	b.Position = UDim2.new(0,x,0,0)
	b.Text = text
	b.Font = FONT
	b.TextSize = 14
	b.TextColor3 = Color3.new(1,1,1)
	b.BackgroundColor3 = color
	b.MouseButton1Click:Connect(cb)
end

-- WALK SPEED (MAIN)
do
	local row = createRow(MainSection)
	label(row, "Walk Speed")
	local box = input(row, 200, "16")

	button(row, 280, "Apply", Color3.fromRGB(0,140,255), function()
		local v = tonumber(box.Text)
		if v and plr.Character then
			plr.Character.Humanoid.WalkSpeed = v
		end
	end)

	button(row, 360, "Reset", Color3.fromRGB(255,60,60), function()
		if plr.Character then
			plr.Character.Humanoid.WalkSpeed = 16
		end
	end)
end

-- FLIGHT WITH SAME BOXES (OP)
do
	local flying = false
	local speed = 50
	local bv

	local row = createRow(OpSection)
	label(row, "Flight")
	local box = input(row, 200, "50")

	button(row, 280, "Apply", Color3.fromRGB(0,140,255), function()
		speed = tonumber(box.Text) or speed
	end)

	button(row, 360, "Reset", Color3.fromRGB(255,60,60), function()
		speed = 50
		box.Text = "50"
	end)

	RunService.RenderStepped:Connect(function()
		if flying and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
			if not bv then
				bv = Instance.new("BodyVelocity", plr.Character.HumanoidRootPart)
				bv.MaxForce = Vector3.new(1e6,1e6,1e6)
			end
			local cam = workspace.CurrentCamera
			local dir = Vector3.zero
			if UIS:IsKeyDown(Enum.KeyCode.W) then dir += cam.CFrame.LookVector end
			if UIS:IsKeyDown(Enum.KeyCode.S) then dir -= cam.CFrame.LookVector end
			if UIS:IsKeyDown(Enum.KeyCode.A) then dir -= cam.CFrame.RightVector end
			if UIS:IsKeyDown(Enum.KeyCode.D) then dir += cam.CFrame.RightVector end
			bv.Velocity = dir * speed
		elseif bv then
			bv:Destroy()
			bv = nil
		end
	end)

	UIS.InputBegan:Connect(function(i,g)
		if g then return end
		if i.KeyCode == Enum.KeyCode.F then
			flying = not flying
		end
	end)
end

-- INFINITE JUMP
do
	local enabled = false
	local row = createRow()
	createLabel(row, "Infinite Jump")
	createToggle(row, function(v) enabled = v end)

	UIS.JumpRequest:Connect(function()
		if enabled and plr.Character and plr.Character:FindFirstChild("Humanoid") then
			plr.Character.Humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
		end
	end)
end

-- NOCLIP
do
	local enabled = false
	local row = createRow()
	createLabel(row, "Noclip")
	createToggle(row, function(v) enabled = v end)

	RunService.Stepped:Connect(function()
		if enabled and plr.Character then
			for _,p in pairs(plr.Character:GetChildren()) do
				if p:IsA("BasePart") then p.CanCollide = false end
			end
		end
	end)
end

-- REMOVE INSANITY
do
	local row = createRow()
	createLabel(row, "Remove Insanity")
	createButton(row, 350, "Remove", Color3.fromRGB(90,90,90), function()
		local t = plr.PlayerGui:FindFirstChild("Temp")
		if t and t:FindFirstChild("Insanity") then t.Insanity:Destroy() end
	end)
end

-- REMOVE FOG
do
	local row = createRow()
	createLabel(row, "Remove Fog")
	createButton(row, 350, "Remove", Color3.fromRGB(90,90,90), function()
		local t = plr.PlayerGui:FindFirstChild("Temp")
		if t and t:FindFirstChild("FogParticles") then t.FogParticles:Destroy() end
	end)
end

-- AUTO WASH
do
	local enabled = false
	local row = createRow()
	createLabel(row, "Auto Wash")

	createToggle(row, function(v)
		enabled = v
		if v then
			task.spawn(function()
				local remote = game.ReplicatedStorage.RS.Remotes.Boats.Wash
				while enabled do
					remote:FireServer()
					task.wait(2)
				end
			end)
		end
	end)
end

-- AUTO BIRDKILL
do
	local enabled = false
	local row = createRow()
	createLabel(row, "Auto BirdKill")

	local remote = game.ReplicatedStorage.RS.Remotes.Misc.BirdKill

	createToggle(row, function(v)
		enabled = v
		if v then
			task.spawn(function()
				while enabled do
					remote:FireServer("Eagle")
					task.wait(1)
				end
			end)
		end
	end)
end

-- CHEST ESP
do
	local enabled = false
	local esp = {}

	local CHESTS = {
		["Treasure Chest"] = Color3.new(1,1,1),
		["Uncommon Chest"] = Color3.new(1,1,1),
		["Rare Chest"] = Color3.new(1,1,1),
		["Mystic Chest"] = Color3.fromRGB(255,0,0),
		["Legendary Chest"] = Color3.fromRGB(0,255,0),
	}

	local function clear()
		for _,g in pairs(esp) do if g then g:Destroy() end end
		esp = {}
	end

	local row = createRow()
	createLabel(row, "Chest ESP")

	createToggle(row, function(v)
		enabled = v
		if not v then clear() end
	end)

	task.spawn(function()
		while true do
			if enabled and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
				local pos = plr.Character.HumanoidRootPart.Position
				for _,m in ipairs(workspace:GetDescendants()) do
					if m:IsA("Model") and CHESTS[m.Name] then
						local p = m.PrimaryPart or m:FindFirstChildWhichIsA("BasePart")
						if p and (p.Position - pos).Magnitude < 2000 then
							if not esp[m] then
								local bb = Instance.new("BillboardGui", m)
								bb.Size = UDim2.new(0,100,0,18)
								bb.AlwaysOnTop = true
								bb.Adornee = p
								bb.StudsOffset = Vector3.new(0,2.5,0)

								local t = Instance.new("TextLabel", bb)
								t.Size = UDim2.new(1,0,1,0)
								t.BackgroundTransparency = 1
								t.Text = m.Name
								t.Font = FONT
								t.TextSize = 13
								t.TextColor3 = CHESTS[m.Name]

								esp[m] = bb
							end
						elseif esp[m] then
							esp[m]:Destroy()
							esp[m] = nil
						end
					end
				end
			end
			task.wait(1)
		end
	end)
end
